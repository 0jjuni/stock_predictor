{% extends "base/base.html" %}
{% load static %}

{% block title %}Stock Prediction{% endblock %}

{% block extra_css %}
<!-- 외부 CSS 파일을 연결합니다. -->
<link rel="stylesheet" href="{% static 'css/predict.css' %}">
{% endblock %}

{% block content %}
<div class="stock-container">
    <!-- 왼쪽의 주식 예측 입력 폼 -->
    <div class="form-container">
        <h1>Enter Stock Data for Prediction</h1>
        <form method="POST" action="{% url 'predict_stock' %}">
            {% csrf_token %}
            <label for="stock_name">Stock Name:</label>
            <input type="text" id="stock_name" name="stock_name" onkeyup="filterStocks()" required autocomplete="off">
            <!-- 자동완성 드롭다운 리스트 -->
            <ul id="autocomplete-list" class="autocomplete-items" style="display: none;"></ul>
            <button type="submit" class="btn-submit">Predict</button>
        </form>

        <!-- 예측 결과 표시 -->
        {% if prediction is not None %}
            <h2>Prediction Result: {{ prediction }}</h2>
        {% endif %}
    </div>
</div>

<!-- 자바스크립트 -->
<script>
    function fillStockName(stockName) {
        document.getElementById('stock_name').value = stockName;
        document.getElementById('autocomplete-list').style.display = 'none';  // 항목을 선택하면 드롭다운을 숨김
    }

    function filterStocks() {
        var input = document.getElementById('stock_name');
        var filter = input.value.toUpperCase();
        var ul = document.getElementById("autocomplete-list");
        var stockList = [{% for name in stock_name_list %}"{{ name }}",{% endfor %}];  // 전체 주식 리스트

        // 기존 리스트 초기화
        ul.innerHTML = '';

        // 입력된 값이 없으면 드롭다운을 숨김
        if (!filter) {
            ul.style.display = 'none';
            return;
        }

        // 입력된 값이 있을 때만 필터링하여 드롭다운을 표시
        stockList.forEach(function(stock) {
            if (stock.toUpperCase().indexOf(filter) > -1) {
                var li = document.createElement('li');
                li.classList.add('stock-item');
                li.textContent = stock;  // 글머리표 없이 텍스트만 추가
                li.onclick = function() {
                    fillStockName(stock);
                };
                ul.appendChild(li);
            }
        });

        // 드롭다운 항목이 있으면 보이고, 없으면 숨김
        ul.style.display = ul.children.length > 0 ? 'block' : 'none';
    }
</script>
{% endblock %}
